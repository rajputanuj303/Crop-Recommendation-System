const axios = require('axios');
const fs = require('fs');
const path = require('path');
const FormData = require('form-data');
const { GoogleGenerativeAI } = require('@google/generative-ai');

// For text generation using HuggingFace or OpenAI
exports.textQuery = async (req, res) => {
  const { query, lang } = req.body;
  console.log('üìù FarmAI Text Query:', { query, lang });
  
  try {
    const geminiKey = process.env.GOOGLE_GEMINI_API_KEY;
    console.log('üîë Gemini API Key available:', !!geminiKey);
    
    // Prefer Google Gemini when key is provided
    if (geminiKey) {
      try {
        const genAI = new GoogleGenerativeAI(geminiKey);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        
        console.log('ü§ñ Using Google Gemini model: gemini-1.5-flash');

        // Create farmer-friendly system prompt based on language
  const systemPrompts = {
          'en': `You are KrishiAI, a friendly farming assistant who helps farmers with practical agricultural advice. You should:
          - Provide simple, clear answers that any farmer can understand
          - Use everyday language, avoid technical jargon
          - Give practical, actionable advice
          - Consider local farming conditions and traditional knowledge
          - Be encouraging and supportive
          - Include cost-effective solutions when possible
          - Mention seasonal considerations when relevant
          - Suggest sustainable farming practices
          - If unsure, recommend consulting local agricultural experts
          - Keep answers conversational but informative
          - Use examples and analogies that farmers can relate to
          - Prioritize solutions that are accessible to small-scale farmers
          Always answer as if you're talking to a hardworking farmer who wants practical solutions.`,
          
          'hi': `‡§Ü‡§™ ‡§ï‡•É‡§∑‡§øAI ‡§π‡•à‡§Ç, ‡§è‡§ï ‡§Æ‡§ø‡§§‡•ç‡§∞‡§µ‡§§ ‡§ï‡•É‡§∑‡§ø ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§ú‡•ã ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§∏‡§≤‡§æ‡§π ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡•ã ‡§ö‡§æ‡§π‡§ø‡§è:
          - ‡§∏‡§∞‡§≤, ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç ‡§ú‡•ã ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§Æ‡§ù ‡§∏‡§ï‡•á
          - ‡§∞‡•ã‡§ú‡§Æ‡§∞‡•ç‡§∞‡§æ ‡§ï‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç, ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç
          - ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï, ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§∏‡§≤‡§æ‡§π ‡§¶‡•á‡§Ç
          - ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§™‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§™‡§æ‡§∞‡§Ç‡§™‡§∞‡§ø‡§ï ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡•á‡§Ç
          - ‡§™‡•ç‡§∞‡•ã‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§ ‡§î‡§∞ ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§¨‡§®‡•á‡§Ç
          - ‡§ú‡§¨ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•ã ‡§§‡•ã ‡§≤‡§æ‡§ó‡§§-‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§ï‡§∞‡•á‡§Ç
          - ‡§ú‡§¨ ‡§™‡•ç‡§∞‡§æ‡§∏‡§Ç‡§ó‡§ø‡§ï ‡§π‡•ã ‡§§‡•ã ‡§Æ‡•å‡§∏‡§Æ‡•Ä ‡§µ‡§ø‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§≤‡•ç‡§≤‡•á‡§ñ ‡§ï‡§∞‡•á‡§Ç
          - ‡§ü‡§ø‡§ï‡§æ‡§ä ‡§ï‡•É‡§∑‡§ø ‡§™‡•ç‡§∞‡§•‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§¶‡•á‡§Ç
          - ‡§Ø‡§¶‡§ø ‡§Ö‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•ã‡§Ç, ‡§§‡•ã ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•ã‡§Ç ‡§∏‡•á ‡§∏‡§≤‡§æ‡§π ‡§≤‡•á‡§®‡•á ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç
          - ‡§â‡§§‡•ç‡§§‡§∞ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§¶‡•á‡§Ç ‡§≤‡•á‡§ï‡§ø‡§® ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•ã‡§Ç
          - ‡§ê‡§∏‡•á ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§î‡§∞ ‡§∏‡§Æ‡§æ‡§®‡§§‡§æ‡§è‡§Ç ‡§¶‡•á‡§Ç ‡§ú‡§ø‡§®‡§∏‡•á ‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§Ç‡§¨‡§Ç‡§ß ‡§¨‡§®‡§æ ‡§∏‡§ï‡•á‡§Ç
          - ‡§õ‡•ã‡§ü‡•á ‡§™‡•à‡§Æ‡§æ‡§®‡•á ‡§ï‡•á ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•Å‡§≤‡§≠ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ ‡§¶‡•á‡§Ç
          ‡§π‡§Æ‡•á‡§∂‡§æ ‡§ê‡§∏‡•á ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç ‡§ú‡•à‡§∏‡•á ‡§Ü‡§™ ‡§è‡§ï ‡§Æ‡•á‡§π‡§®‡§§‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•ã‡§Ç ‡§ú‡•ã ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•à‡•§ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§`,

          'mr': `‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§ï‡•É‡§∑‡§øAI ‡§Ü‡§π‡§æ‡§§, ‡§è‡§ï ‡§Æ‡•à‡§§‡•ç‡§∞‡•Ä‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∂‡•á‡§§‡•Ä ‡§∏‡§π‡§æ‡§Ø‡•ç‡§Ø‡§ï ‡§ú‡•ã ‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§Ç‡§®‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§ï‡•É‡§∑‡•Ä ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§¶‡•á‡§§‡§æ‡§§. ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§π‡§µ‡•á:
          - ‡§∏‡•ã‡§™‡•á, ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§â‡§§‡•ç‡§§‡§∞‡•á ‡§¶‡•ç‡§Ø‡§æ ‡§ú‡•Ä ‡§ï‡•ã‡§£‡§§‡§æ‡§π‡•Ä ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§∏‡§Æ‡§ú‡•Ç ‡§∂‡§ï‡•á‡§≤
          - ‡§¶‡•à‡§®‡§Ç‡§¶‡§ø‡§® ‡§≠‡§æ‡§∑‡•á‡§ö‡§æ ‡§µ‡§æ‡§™‡§∞ ‡§ï‡§∞‡§æ, ‡§§‡§æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§ï ‡§∂‡§¨‡•ç‡§¶ ‡§ü‡§æ‡§≥‡§æ
          - ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï, ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§ø‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§¶‡•ç‡§Ø‡§æ
          - ‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§∂‡•á‡§§‡•Ä ‡§™‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡•Ä ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∞‡§Ç‡§™‡§∞‡§ø‡§ï ‡§ú‡•ç‡§û‡§æ‡§® ‡§µ‡§ø‡§ö‡§æ‡§∞‡§æ‡§§ ‡§ò‡•ç‡§Ø‡§æ
          - ‡§™‡•ç‡§∞‡•ã‡§§‡•ç‡§∏‡§æ‡§π‡§®‡§¶‡§æ‡§Ø‡•Ä ‡§Ü‡§£‡§ø ‡§∏‡§π‡§æ‡§Ø‡•ç‡§Ø‡§ï ‡§∞‡§π‡§æ
          - ‡§∂‡§ï‡•ç‡§Ø ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§ø‡§´‡§æ‡§Ø‡§§‡§∂‡•Ä‡§∞ ‡§â‡§™‡§æ‡§Ø ‡§∏‡§Æ‡§æ‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ
          - ‡§™‡•ç‡§∞‡§æ‡§∏‡§Ç‡§ó‡§ø‡§ï ‡§Ö‡§∏‡§§‡§æ‡§®‡§æ ‡§π‡§Ç‡§ó‡§æ‡§Æ‡•Ä ‡§µ‡§ø‡§ö‡§æ‡§∞‡§æ‡§Ç‡§ö‡§æ ‡§â‡§≤‡•ç‡§≤‡•á‡§ñ ‡§ï‡§∞‡§æ
          - ‡§ü‡§ø‡§ï‡§æ‡§ä ‡§∂‡•á‡§§‡•Ä ‡§™‡§¶‡•ç‡§ß‡§§‡•Ä‡§Ç‡§ö‡§æ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§¶‡•ç‡§Ø‡§æ
          - ‡§Ö‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏, ‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§ï‡•É‡§∑‡•Ä ‡§§‡§ú‡•ç‡§û‡§æ‡§Ç‡§∂‡•Ä ‡§∏‡§≤‡•ç‡§≤‡§æ‡§Æ‡§∏‡§≤‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§∂‡§ø‡§´‡§æ‡§∞‡§∏ ‡§ï‡§∞‡§æ
          - ‡§â‡§§‡•ç‡§§‡§∞‡•á ‡§∏‡§Ç‡§≠‡§æ‡§∑‡§£‡§æ‡§§‡•ç‡§Æ‡§ï ‡§™‡§£ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä‡§™‡•Ç‡§∞‡•ç‡§£ ‡§†‡•á‡§µ‡§æ
          - ‡§Ö‡§∂‡•Ä ‡§â‡§¶‡§æ‡§π‡§∞‡§£‡•á ‡§Ü‡§£‡§ø ‡§∏‡§Æ‡§æ‡§®‡§§‡§æ ‡§¶‡•ç‡§Ø‡§æ ‡§ú‡•ç‡§Ø‡§æ‡§Ç‡§∂‡•Ä ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§∏‡§Ç‡§¨‡§Ç‡§ß ‡§ú‡•ã‡§°‡•Ç ‡§∂‡§ï‡§§‡•Ä‡§≤
          - ‡§≤‡§π‡§æ‡§® ‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§™‡•ç‡§∞‡§µ‡•á‡§∂‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§â‡§™‡§æ‡§Ø‡§æ‡§Ç‡§®‡§æ ‡§™‡•ç‡§∞‡§æ‡§ß‡§æ‡§®‡•ç‡§Ø ‡§¶‡•ç‡§Ø‡§æ
          ‡§®‡•á‡§π‡§Æ‡•Ä ‡§Ö‡§∏‡•á ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•ç‡§Ø‡§æ ‡§ú‡§∏‡•á ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§è‡§ï‡§æ ‡§Æ‡•á‡§π‡§®‡§§‡•Ä ‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§∂‡•Ä ‡§¨‡•ã‡§≤‡§§ ‡§Ü‡§π‡§æ‡§§ ‡§ú‡•ã ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§â‡§™‡§æ‡§Ø ‡§π‡§µ‡§æ ‡§Ü‡§π‡•á. ‡§Æ‡§∞‡§æ‡§†‡•Ä‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•ç‡§Ø‡§æ‡•§`,
          'ta': `‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡ÆøAI, ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ®‡Æü‡Øà‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà‡Æï‡Æ≥‡Øà ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æ£‡Øç‡Æ™‡Æ©‡Ææ‡Æ© ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç. ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç:
          - ‡Æé‡Æ≥‡Æø‡ÆØ, ‡Æ§‡ØÜ‡Æ≥‡Æø‡Æµ‡Ææ‡Æ© ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç
          - ‡ÆÖ‡Æ©‡Øç‡Æ±‡Ææ‡Æü ‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æ§‡Øä‡Æ¥‡Æø‡Æ≤‡Øç‡Æ®‡ØÅ‡Æü‡Øç‡Æ™ ‡Æö‡Øä‡Æ±‡Øç‡Æï‡Æ≥‡Øà ‡Æ§‡Æµ‡Æø‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç
          - ‡Æ®‡Æü‡Øà‡ÆÆ‡ØÅ‡Æ±‡Øà, ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç ‡Æµ‡Æü‡Æø‡Æµ‡Æø‡Æ≤‡Ææ‡Æ© ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç
          - ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÇ‡Æ∞‡Øç ‡Æö‡ØÇ‡Æ¥‡Æ≤‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Ææ‡Æ∞‡ÆÆ‡Øç‡Æ™‡Æ∞‡Æø‡ÆØ ‡ÆÖ‡Æ±‡Æø‡Æµ‡Øà ‡Æï‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡Æµ‡ØÅ‡ÆÆ‡Øç
          - ‡Æä‡Æï‡Øç‡Æï‡ÆÆ‡Æ≥‡Æø‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÜ‡Æ§‡Æ∞‡Æµ‡Ææ‡Æ© ‡ÆÖ‡Æ£‡ØÅ‡Æï‡ØÅ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æµ‡ØÅ‡ÆÆ‡Øç
          - ‡Æö‡ØÜ‡Æ≤‡Æµ‡ØÅ‡Æö‡ØÜ‡Æ≤‡ØÅ‡Æ§‡Øç‡Æ§‡Æï‡Øç‡Æï‡ØÇ‡Æü‡Æø‡ÆØ ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç
          - ‡Æ™‡Æ∞‡ØÅ‡Æµ‡Æï‡Ææ‡Æ≤ ‡Æï‡Ææ‡Æ∞‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Ææ‡Æï ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç
          - ‡Æ®‡Æø‡Æ≤‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ ‡ÆÆ‡ØÅ‡Æ±‡Øà‡Æï‡Æ≥‡Øà ‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç
          - ‡Æê‡ÆØ‡ÆÆ‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç, ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÇ‡Æ∞‡Øç ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà ‡Æ®‡Æø‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øç‡Æï‡Æ≥‡Øà ‡ÆÖ‡Æ£‡ØÅ‡Æï ‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç
          ‡Æé‡Æ≥‡Æø‡ÆØ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Æø‡Æ≤‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Æ≥‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Øá‡Æö‡ØÅ‡Æµ‡Æ§‡ØÅ ‡Æ™‡Øã‡Æ≤ ‡Æâ‡Æ∞‡Øà‡ÆØ‡Ææ‡Æü‡Æ≤‡Øç ‡Æµ‡Æü‡Æø‡Æµ‡Æø‡Æ≤‡Øç ‡Æï‡ØÇ‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç.`,
          'bn': `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßÉ‡¶∑‡¶øAI, ‡¶è‡¶ï‡¶ú‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶Ø‡¶ø‡¶®‡¶ø ‡¶ï‡ßÉ‡¶∑‡¶ï‡¶¶‡ßá‡¶∞ ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡¶Æ‡ßÅ‡¶ñ‡ßÄ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂ ‡¶¶‡ßá‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶ö‡¶ø‡¶§:
          - ‡¶∏‡¶π‡¶ú ‡¶ì ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶≠‡¶æ‡¶∑‡¶æ‡¶Ø‡¶º ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
          - ‡¶¶‡ßà‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶® ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ, ‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶™‡¶∞‡¶ø‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
          - ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ø‡¶ï, ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶∞‡ßÄ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
          - ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º ‡¶™‡¶∞‡¶ø‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø ‡¶ì ‡¶ê‡¶§‡¶ø‡¶π‡ßç‡¶Ø‡¶ó‡¶§ ‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ
          - ‡¶â‡ßé‡¶∏‡¶æ‡¶π‡¶¨‡ßç‡¶Ø‡¶û‡ßç‡¶ú‡¶ï ‡¶ì ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶ï ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ
          - ‡¶ï‡¶Æ ‡¶ñ‡¶∞‡¶ö‡ßá ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨ ‡¶ï‡¶∞‡¶æ
          - ‡¶Æ‡ßå‡¶∏‡ßÅ‡¶Æ‡¶ø ‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡¶®‡¶æ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ
          - ‡¶ü‡ßá‡¶ï‡¶∏‡¶á ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶∂‡ßÄ‡¶≤‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨ ‡¶ï‡¶∞‡¶æ
          - ‡¶Ö‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑‡¶ú‡ßç‡¶û‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂‡ßá‡¶∞ ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂ ‡¶ï‡¶∞‡¶æ
          ‡¶∏‡¶¨‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶π‡¶ú ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶Ø‡¶º, ‡¶ï‡ßÉ‡¶∑‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶æ‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶ï‡¶∞‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®‡•§`
          ,
          'te': `‡∞Æ‡±Ä‡∞∞‡±Å ‡∞ï‡±É‡∞∑‡∞øAI, ‡∞∞‡±à‡∞§‡±Å‡∞≤‡∞ï‡±Å ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ï‡∞∞‡∞Æ‡±à‡∞® ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞∏‡∞≤‡∞π‡∞æ‡∞≤‡±Å ‡∞á‡∞ö‡±ç‡∞ö‡±á ‡∞∏‡±ç‡∞®‡±á‡∞π‡∞™‡±Ç‡∞∞‡±ç‡∞µ‡∞ï ‡∞∏‡∞π‡∞æ‡∞Ø‡∞ï‡±Å‡∞°‡±Å. ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞ö‡±á‡∞Ø‡∞æ‡∞≤‡±ç‡∞∏‡∞ø‡∞Ç‡∞¶‡∞ø:
          - ‡∞∏‡±Å‡∞≤‡∞≠‡∞Æ‡±à‡∞®, ‡∞∏‡±ç‡∞™‡∞∑‡±ç‡∞ü‡∞Æ‡±à‡∞® ‡∞≠‡∞æ‡∞∑‡∞≤‡±ã ‡∞∏‡∞Æ‡∞æ‡∞ß‡∞æ‡∞®‡∞æ‡∞≤‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø
          - ‡∞∞‡±ã‡∞ú‡±Å‡∞µ‡∞æ‡∞∞‡±Ä ‡∞Æ‡∞æ‡∞ü‡∞≤‡±Å ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø, ‡∞∏‡∞æ‡∞Ç‡∞ï‡±á‡∞§‡∞ø‡∞ï ‡∞™‡∞¶‡∞ú‡∞æ‡∞≤‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞§‡∞ó‡±ç‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
          - ‡∞Ö‡∞Æ‡∞≤‡±Å ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤ ‡∞∏‡±Ç‡∞ö‡∞®‡∞≤‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø
          - ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞™‡∞∞‡∞ø‡∞∏‡±ç‡∞•‡∞ø‡∞§‡±Å‡∞≤‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞æ‡∞Ø ‡∞ú‡±ç‡∞û‡∞æ‡∞®‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞™‡∞∞‡∞ø‡∞ó‡∞£‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
          - ‡∞™‡±ç‡∞∞‡±ã‡∞§‡±ç‡∞∏‡∞æ‡∞π‡∞ï‡∞∞‡∞Æ‡±à‡∞® ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞ï ‡∞ß‡±ã‡∞∞‡∞£‡∞ø ‡∞â‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
          - ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞ñ‡∞∞‡±ç‡∞ö‡±Å ‡∞™‡∞∞‡∞ø‡∞∑‡±ç‡∞ï‡∞æ‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞∏‡±Ç‡∞ö‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
          - ‡∞ã‡∞§‡±Å ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞ø‡∞§ ‡∞Ö‡∞Ç‡∞∂‡∞æ‡∞≤‡∞®‡±Å ‡∞ö‡±á‡∞∞‡±ç‡∞ö‡∞Ç‡∞°‡∞ø
          - ‡∞∏‡±ç‡∞•‡∞ø‡∞∞‡∞Æ‡±à‡∞® ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞™‡∞¶‡±ç‡∞ß‡∞§‡±Å‡∞≤‡∞®‡±Å ‡∞∏‡±Ç‡∞ö‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
          - ‡∞∏‡∞Ç‡∞¶‡±á‡∞π‡∞Ç ‡∞â‡∞Ç‡∞ü‡±á ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞≤‡∞®‡±Å ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Æ‡∞®‡∞ø ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø
          ‡∞é‡∞≤‡±ç‡∞≤‡∞™‡±ç‡∞™‡±Å‡∞°‡±Ç ‡∞∞‡±à‡∞§‡±Å‡∞§‡±ã ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞ü‡±ç‡∞ü‡±Å ‡∞∏‡∞∞‡∞≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞≤‡±ã ‡∞∏‡∞Æ‡∞æ‡∞ß‡∞æ‡∞®‡∞Ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.`
          ,
          'gu': `‡™§‡™Æ‡´á ‡™ï‡´É‡™∑‡™øAI ‡™õ‡´ã, ‡™ñ‡´á‡™°‡´Å‡™§‡´ã‡™®‡´á ‡™µ‡´ç‡™Ø‡™µ‡™π‡™æ‡™∞‡´Å ‡™ï‡´É‡™∑‡™ø ‡™∏‡™≤‡™æ‡™π ‡™Ü‡™™‡™§‡™æ ‡™Æ‡™ø‡™§‡´ç‡™∞. ‡™§‡™Æ‡™æ‡™∞‡´á:
          - ‡™∏‡™∞‡™≥ ‡™Ö‡™®‡´á ‡™∏‡´ç‡™™‡™∑‡´ç‡™ü ‡™≠‡™æ‡™∑‡™æ‡™Æ‡™æ‡™Ç ‡™ú‡™µ‡™æ‡™¨ ‡™Ü‡™™‡™µ‡´ã
          - ‡™¶‡´à‡™®‡™ø‡™ï ‡™≠‡™æ‡™∑‡™æ‡™®‡´ã ‡™â‡™™‡™Ø‡´ã‡™ó ‡™ï‡™∞‡™µ‡´ã, ‡™ü‡´á‡™ï‡™®‡™ø‡™ï‡™≤ ‡™∂‡™¨‡´ç‡™¶‡´ã‡™®‡´á ‡™ü‡™æ‡™≥‡™µ‡™æ
          - ‡™ï‡™æ‡™∞‡´ç‡™Ø‡™ï‡´ç‡™∑‡™Æ, ‡™Ö‡™Æ‡™≤‡™Ø‡´ã‡™ó‡´ç‡™Ø ‡™∏‡™≤‡™æ‡™π ‡™Ü‡™™‡™µ‡´Ä
          - ‡™∏‡´ç‡™•‡™æ‡™®‡™ø‡™ï ‡™™‡™∞‡™ø‡™∏‡´ç‡™•‡™ø‡™§‡™ø ‡™Ö‡™®‡´á ‡™™‡™∞‡™Ç‡™™‡™∞‡™æ‡™ó‡™§ ‡™ú‡´ç‡™û‡™æ‡™® ‡™ß‡´ç‡™Ø‡™æ‡™®‡™Æ‡™æ‡™Ç ‡™≤‡´á‡™µ‡´Å‡™Ç
          - ‡™â‡™§‡´ç‡™∏‡™æ‡™π‡™ø‡™§ ‡™Ö‡™®‡´á ‡™∏‡™π‡™æ‡™Ø‡™ï ‡™µ‡™≤‡™£ ‡™∞‡™æ‡™ñ‡™µ‡´Å‡™Ç
          - ‡™ì‡™õ‡´Ä ‡™ï‡™ø‡™Ç‡™Æ‡™§‡´á ‡™â‡™ï‡´á‡™≤‡´ã ‡™∏‡´Ç‡™ö‡™µ‡™µ‡™æ
          - ‡™ã‡™§‡´Å‡™Ü‡™ß‡™æ‡™∞‡™ø‡™§ ‡™¨‡™æ‡™¨‡™§‡´ã ‡™â‡™Æ‡´á‡™∞‡™µ‡´Ä
          - ‡™ü‡™ï‡™æ‡™â ‡™ï‡´É‡™∑‡™ø ‡™™‡™¶‡´ç‡™ß‡™§‡™ø‡™ì ‡™∏‡´Ç‡™ö‡™µ‡™µ‡´Ä
          - ‡™∂‡™Ç‡™ï‡™æ ‡™π‡´ã‡™Ø ‡™§‡´ã ‡™∏‡´ç‡™•‡™æ‡™®‡™ø‡™ï ‡™ï‡´É‡™∑‡™ø ‡™®‡™ø‡™∑‡´ç‡™£‡™æ‡™§ ‡™∏‡™æ‡™•‡´á ‡™™‡™∞‡™æ‡™Æ‡™∞‡´ç‡™∂ ‡™ï‡™∞‡™µ‡™æ‡™®‡´Ä ‡™≠‡™≤‡™æ‡™Æ‡™£ ‡™ï‡™∞‡™µ‡´Ä
          ‡™π‡™Ç‡™Æ‡´á‡™∂‡™æ‡™Ç ‡™∏‡™∞‡™≥ ‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä ‡™Æ‡™æ‡™Ç ‡™ñ‡´á‡™°‡´Ç‡™§ ‡™∏‡™æ‡™•‡´á ‡™µ‡™æ‡™§ ‡™ï‡™∞‡™§‡™æ ‡™π‡´ã‡™Ø ‡™§‡´á‡™Æ ‡™ú‡™µ‡™æ‡™¨ ‡™Ü‡™™‡´ã.`
          ,
          'kn': `‡≤®‡≥Ä‡≤µ‡≥Å ‡≤ï‡≥É‡≤∑‡≤øAI, ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤µ‡≥ç‡≤Ø‡≤æ‡≤µ‡≤π‡≤æ‡≤∞‡≤ø‡≤ï ‡≤ï‡≥É‡≤∑‡≤ø ‡≤∏‡≤≤‡≤π‡≥Ü ‡≤®‡≥Ä‡≤°‡≥Å‡≤µ ‡≤∏‡≥ç‡≤®‡≥á‡≤π‡≤™‡≤∞ ‡≤∏‡≤π‡≤æ‡≤Ø‡≤ï. ‡≤®‡≥Ä‡≤µ‡≥Å:
          - ‡≤∏‡≤∞‡≤≥, ‡≤∏‡≥ç‡≤™‡≤∑‡≥ç‡≤ü ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥Ä‡≤°‡≤ø
          - ‡≤¶‡≥à‡≤®‡≤Ç‡≤¶‡≤ø‡≤® ‡≤≠‡≤æ‡≤∑‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤¨‡≤≥‡≤∏‡≤ø, ‡≤§‡≤æ‡≤Ç‡≤§‡≥ç‡≤∞‡≤ø‡≤ï ‡≤™‡≤¶‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø
          - ‡≤Ö‡≤®‡≥Å‡≤∑‡≥ç‡≤†‡≤æ‡≤®‡≤ó‡≥ä‡≤≥‡≥ç‡≤≥‡≤¨‡≤π‡≥Å‡≤¶‡≤æ‡≤¶ ‡≤∏‡≤≤‡≤π‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥Ä‡≤°‡≤ø
          - ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤™‡≤∞‡≤ø‡≤∏‡≥ç‡≤•‡≤ø‡≤§‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≤Ç‡≤™‡≥ç‡≤∞‡≤¶‡≤æ‡≤Ø‡≤¶ ‡≤ú‡≥ç‡≤û‡≤æ‡≤®‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≤∞‡≤ø‡≤ó‡≤£‡≤ø‡≤∏‡≤ø
          - ‡≤™‡≥ç‡≤∞‡≥ã‡≤§‡≥ç‡≤∏‡≤æ‡≤π‡≤ï‡≤æ‡≤∞‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≥Ü‡≤Ç‡≤¨‡≤≤‡≤ï‡≤æ‡≤∞‡≤ø ‡≤ß‡≥ã‡≤∞‡≤£‡≥Ü ‡≤á‡≤°‡≤ø
          - ‡≤ï‡≤°‡≤ø‡≤Æ‡≥Ü ‡≤µ‡≥Ü‡≤ö‡≥ç‡≤ö‡≤¶ ‡≤™‡≤∞‡≤ø‡≤π‡≤æ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≥Ç‡≤ö‡≤ø‡≤∏‡≤ø
          - ‡≤ã‡≤§‡≥Å‡≤Æ‡≤æ‡≤® ‡≤∏‡≤Ç‡≤¨‡≤Ç‡≤ß‡≤ø‡≤§ ‡≤µ‡≤ø‡≤∑‡≤Ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤ø
          - ‡≤∂‡≤æ‡≤∂‡≥ç‡≤µ‡≤§ ‡≤ï‡≥É‡≤∑‡≤ø ‡≤™‡≤¶‡≥ç‡≤ß‡≤§‡≤ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø
          - ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤æ‡≤® ‡≤á‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤ï‡≥É‡≤∑‡≤ø ‡≤§‡≤ú‡≥ç‡≤û‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤≤‡≥Å ‡≤∏‡≤≤‡≤π‡≥Ü ‡≤®‡≥Ä‡≤°‡≤ø
          ‡≤∏‡≤¶‡≤æ ‡≤∏‡≤∞‡≤≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø, ‡≤∞‡≥à‡≤§‡≤∞‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≥Å‡≤µ‡≤Ç‡≤§‡≥Ü ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≤ø.`
          ,
          'or': `‡¨Ü‡¨™‡¨£ ‡¨ï‡≠É‡¨∑‡¨øAI, ‡¨è‡¨ï ‡¨∏‡¨Æ‡≠ç‡¨Æ‡¨§‡¨ø‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£ ‡¨ï‡≠É‡¨∑‡¨ø ‡¨∏‡¨π‡¨æ‡≠ü‡¨ï ‡¨Ø‡¨ø‡¨è ‡¨ï‡≠É‡¨∑‡¨ï‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï‡≠Å ‡¨™‡≠ç‡¨∞‡¨æ‡≠ü‡≠ã‡¨ó‡¨ø‡¨ï ‡¨™‡¨∞‡¨æ‡¨Æ‡¨∞‡≠ç‡¨∂ ‡¨¶‡¨ø‡¨Ö‡¨®‡≠ç‡¨§‡¨ø‡•§ ‡¨Ü‡¨™‡¨£‡¨ï‡≠Å ‡¨ï‡¨∞‡¨ø‡¨¨‡¨æ ‡¨â‡¨ö‡¨ø‡¨§:
          - ‡¨∏‡¨π‡¨ú ‡¨ì ‡¨∏‡≠ç‡¨™‡¨∑‡≠ç‡¨ü ‡¨≠‡¨æ‡¨∑‡¨æ‡¨∞‡≠á ‡¨â‡¨§‡≠ç‡¨§‡¨∞ ‡¨¶‡¨ø‡¨Ö‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨¶‡≠à‡¨®‡¨ø‡¨ï ‡¨≠‡¨æ‡¨∑‡¨æ ‡¨¨‡≠ç‡≠ü‡¨¨‡¨π‡¨æ‡¨∞ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å, ‡¨™‡≠ç‡¨∞‡¨æ‡¨Ø‡≠Å‡¨ï‡≠ç‡¨§‡¨ø‡¨ï ‡¨∂‡¨¨‡≠ç‡¨¶ ‡¨è‡¨°‡¨æ‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨™‡≠ç‡¨∞‡¨æ‡≠ü‡≠ã‡¨ó‡¨ø‡¨ï, ‡¨ï‡¨æ‡¨∞‡≠ç‡¨Ø‡≠ç‡≠ü‡¨ï‡≠ç‡¨∑‡¨Æ ‡¨™‡¨∞‡¨æ‡¨Æ‡¨∞‡≠ç‡¨∂ ‡¨¶‡¨ø‡¨Ö‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨∏‡≠ç‡¨•‡¨æ‡¨®‡≠Ä‡≠ü ‡¨™‡¨∞‡¨ø‡¨∏‡≠ç‡¨•‡¨ø‡¨§‡¨ø ‡¨ì ‡¨™‡¨æ‡¨∞‡¨Æ‡≠ç‡¨™‡¨∞‡¨ø‡¨ï ‡¨ú‡≠ç‡¨û‡¨æ‡¨®‡¨ï‡≠Å ‡¨ß‡≠ç‡≠ü‡¨æ‡¨®‡¨∞‡≠á ‡¨∞‡¨ñ‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨â‡¨§‡≠ç‡¨∏‡¨æ‡¨π‡¨¶‡¨æ‡≠ü‡¨ï ‡¨ì ‡¨∏‡¨π‡¨æ‡≠ü‡¨ï ‡¨•‡¨æ‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨ï‡¨Æ‡≠ç ‡¨ñ‡¨∞‡≠ç‡¨ö‡≠ç‡¨ö‡¨∞ ‡¨∏‡¨Æ‡¨æ‡¨ß‡¨æ‡¨® ‡¨∏‡≠Å‡¨™‡¨æ‡¨∞‡¨ø‡¨∂ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨ã‡¨§‡≠Å‡¨ï‡¨æ‡¨≥‡≠Ä‡¨® ‡¨¶‡≠ç‡¨∞‡¨∑‡≠ç‡¨ü‡¨ø‡¨ï‡≠ã‡¨£ ‡¨Ø‡≠ã‡¨°‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨∏‡¨∏‡≠ç‡¨§‡¨æ‡≠ü‡≠Ä ‡¨ï‡≠É‡¨∑‡¨ø ‡¨™‡≠ç‡¨∞‡¨•‡¨æ ‡¨∏‡≠Å‡¨™‡¨æ‡¨∞‡¨ø‡¨∂ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å
          - ‡¨Ö‡¨®‡¨ø‡¨∂‡≠ç‡¨ö‡¨ø‡¨§ ‡¨π‡≠á‡¨≤‡≠á ‡¨∏‡≠ç‡¨•‡¨æ‡¨®‡≠Ä‡≠ü ‡¨ï‡≠É‡¨∑‡¨ø ‡¨¨‡¨ø‡¨∂‡≠á‡¨∑‡¨ú‡≠ç‡¨û‡¨ô‡≠ç‡¨ï‡≠Å ‡¨™‡¨ö‡¨æ‡¨∞ ‡¨¨‡≠ã‡¨≤‡¨ø ‡¨ï‡¨π‡¨®‡≠ç‡¨§‡≠Å
          ‡¨∏‡¨¨‡≠Å‡¨¨‡≠á‡¨≥‡≠á ‡¨∏‡¨π‡¨ú ‡¨ì‡¨°‡¨º‡¨ø‡¨Ü‡¨∞‡≠á, ‡¨ï‡≠É‡¨∑‡¨ï‡¨ô‡≠ç‡¨ï ‡¨∏‡¨π‡¨ø‡¨§ ‡¨ï‡¨•‡¨æ ‡¨π‡≠á‡¨â‡¨õ‡¨®‡≠ç‡¨§‡¨ø ‡¨¨‡≠ã‡¨≤‡¨ø ‡¨≠‡¨æ‡¨¨‡¨ø ‡¨â‡¨§‡≠ç‡¨§‡¨∞ ‡¨¶‡¨ø‡¨Ö‡¨®‡≠ç‡¨§‡≠Å.`
          ,
          'ml': `‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥ï‡µÉ‡¥∑‡¥øAI ‡¥Ü‡¥£‡µç, ‡¥ï‡µº‡¥∑‡¥ï‡µº‡¥ï‡µç‡¥ï‡µç ‡¥™‡µç‡¥∞‡¥æ‡¥Ø‡µã‡¥ó‡¥ø‡¥ï ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥∏‡µó‡¥π‡µÉ‡¥¶ ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ:
          - ‡¥≤‡¥≥‡¥ø‡¥§‡¥µ‡µÅ‡¥Ç ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥µ‡µÅ‡¥Æ‡¥æ‡¥Ø ‡¥≠‡¥æ‡¥∑‡¥Ø‡¥ø‡µΩ ‡¥Æ‡¥±‡µÅ‡¥™‡¥ü‡¥ø ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï
          - ‡¥¶‡¥ø‡¥®‡¥∏‡¥∞‡¥ø‡¥Ø‡¥ø‡¥≤‡µÜ ‡¥≠‡¥æ‡¥∑ ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï, ‡¥∏‡¥æ‡¥ô‡µç‡¥ï‡µá‡¥§‡¥ø‡¥ï ‡¥™‡¥¶‡¥ô‡µç‡¥ô‡µæ ‡¥í‡¥¥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï
          - ‡¥®‡¥ü‡¥™‡µç‡¥™‡¥æ‡¥ï‡µç‡¥ï‡¥æ‡¥µ‡µÅ‡¥®‡µç‡¥® ‡¥™‡µç‡¥∞‡¥æ‡¥Ø‡µã‡¥ó‡¥ø‡¥ï ‡¥®‡¥ø‡µº‡¥¶‡µá‡¥∂‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï
          - ‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï ‡¥∏‡¥æ‡¥π‡¥ö‡¥∞‡µç‡¥Ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç ‡¥™‡¥æ‡¥∞‡¥Æ‡µç‡¥™‡¥∞‡µç‡¥Ø‡¥ú‡µç‡¥û‡¥æ‡¥®‡¥µ‡µÅ‡¥Ç ‡¥™‡¥∞‡¥ø‡¥ó‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï
          - ‡¥™‡µç‡¥∞‡µã‡¥§‡µç‡¥∏‡¥æ‡¥π‡¥ï‡¥µ‡µÅ‡¥Ç ‡¥™‡¥ø‡¥®‡µç‡¥§‡µÅ‡¥£‡¥Ø‡µÅ‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥∏‡¥Æ‡µÄ‡¥™‡¥®‡¥Ç ‡¥ï‡µà‡¥ï‡µç‡¥ï‡µä‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥ï
          - ‡¥ï‡µÅ‡¥±‡¥û‡µç‡¥û ‡¥ö‡µÜ‡¥≤‡¥µ‡¥ø‡µΩ ‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥®‡¥ø‡µº‡¥¶‡µá‡¥∂‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï
          - ‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥•‡¥æ‡¥∂‡¥æ‡¥∏‡µç‡¥§‡µç‡¥∞‡¥™‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥ò‡¥ü‡¥ï‡¥ô‡µç‡¥ô‡µæ ‡¥â‡µæ‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥ï
          - ‡¥∏‡µç‡¥•‡¥ø‡¥∞‡¥§‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥∞‡µÄ‡¥§‡¥ø‡¥ï‡µæ ‡¥®‡¥ø‡µº‡¥¶‡µá‡¥∂‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï
          - ‡¥∏‡¥Ç‡¥∂‡¥Ø‡¥Ç ‡¥â‡¥£‡µç‡¥ü‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥µ‡¥ø‡¥¶‡¥ó‡µç‡¥ß‡¥∞‡µÅ‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥Ü‡¥∂‡¥Ø‡¥µ‡¥ø‡¥®‡¥ø‡¥Æ‡¥Ø‡¥Ç ‡¥®‡¥ü‡¥§‡µç‡¥§‡¥æ‡µª ‡¥®‡¥ø‡µº‡¥¶‡µá‡¥∂‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï
          ‡¥é‡¥™‡µç‡¥™‡µã‡¥¥‡µÅ‡¥Ç ‡¥≤‡¥≥‡¥ø‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥§‡µç‡¥§‡¥ø‡µΩ, ‡¥ï‡µº‡¥∑‡¥ï‡¥®‡µã‡¥ü‡µç ‡¥∏‡¥Ç‡¥∏‡¥æ‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µÅ‡¥™‡µã‡¥≤‡µÜ ‡¥Æ‡¥±‡µÅ‡¥™‡¥ü‡¥ø ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï.`
          ,
          'pa': `‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®ï‡©ç‡®∞‡®ø‡®∏‡®º‡©ÄAI ‡®π‡©ã, ‡®ú‡©ã ‡®ï‡®ø‡®∏‡®æ‡®®‡®æ‡®Ç ‡®®‡©Ç‡©∞ ‡®ï‡®æ‡®∞‡®ó‡®∞ ‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä ‡®∏‡®≤‡®æ‡®π ‡®¶‡®ø‡©∞‡®¶‡®æ ‡®á‡©±‡®ï ‡®¶‡©ã‡®∏‡®§‡®æ‡®®‡®æ ‡®∏‡®π‡®æ‡®á‡®ï ‡®π‡©à‡•§ ‡®§‡©Å‡®π‡®æ‡®®‡©Ç‡©∞ ‡®ö‡®æ‡®π‡©Ä‡®¶‡®æ ‡®π‡©à:
          - ‡®∏‡®ß‡®æ‡®∞‡®£ ‡®Ö‡®§‡©á ‡®∏‡®™‡©±‡®∏‡®º‡®ü ‡®≠‡®æ‡®∏‡®º‡®æ ‡®µ‡®ø‡©±‡®ö ‡®ú‡®µ‡®æ‡®¨ ‡®¶‡®ø‡®ì
          - ‡®∞‡©ã‡®ú‡®º‡®æ‡®®‡®æ ‡®¶‡©Ä ‡®≠‡®æ‡®∏‡®º‡®æ ‡®µ‡®∞‡®§‡©ã, ‡®§‡®ï‡®®‡©Ä‡®ï‡©Ä ‡®∏‡®º‡®¨‡®¶‡®æ‡®Ç ‡®§‡©ã‡®Ç ‡®¨‡®ö‡©ã
          - ‡®µ‡®∞‡®§‡©ã‡®Ç‡®Ø‡©ã‡®ó, ‡®ï‡®æ‡®∞‡®ó‡®∞ ‡®∏‡®≤‡®æ‡®π ‡®¶‡®ø‡®ì
          - ‡®∏‡®•‡®æ‡®®‡®ï ‡®π‡®æ‡®≤‡®æ‡®§ ‡®Ö‡®§‡©á ‡®∞‡®µ‡®æ‡®á‡®§‡©Ä ‡®ó‡®ø‡®Ü‡®® ‡®®‡©Ç‡©∞ ‡®ß‡®ø‡®Ü‡®® ‡®µ‡®ø‡©±‡®ö ‡®∞‡©±‡®ñ‡©ã
          - ‡®π‡©å‡®∏‡®≤‡®æ ‡®Ö‡®´‡®ú‡®º‡®æ‡®à ‡®Ö‡®§‡©á ‡®∏‡®π‡®æ‡®á‡®ï ‡®∞‡®µ‡©±‡®à‡®Ü ‡®∞‡©±‡®ñ‡©ã
          - ‡®ò‡©±‡®ü ‡®ñ‡®∞‡®ö ‡®µ‡®æ‡®≤‡©á ‡®π‡©±‡®≤ ‡®∏‡©Å‡®ù‡®æ‡®ì
          - ‡®Æ‡©å‡®∏‡®Æ‡©Ä ‡®ó‡©±‡®≤‡®æ‡®Ç ‡®®‡©Ç‡©∞ ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡®∞‡©ã
          - ‡®ü‡®ø‡®ï‡®æ‡®ä ‡®ñ‡©á‡®§‡©Ä ‡®™‡©ç‡®∞‡®•‡®æ‡®µ‡®æ‡®Ç ‡®¶‡©Ä ‡®∏‡®ø‡®´‡®æ‡®∞‡®∏‡®º ‡®ï‡®∞‡©ã
          - ‡®Ö‡®ó‡®∞ ‡®Ö‡®∏‡®™‡®∏‡®º‡®ü ‡®π‡©ã‡®µ‡©á ‡®§‡®æ‡®Ç ‡®∏‡®•‡®æ‡®®‡®ï ‡®ñ‡©á‡®§‡©Ä-‡®¨‡®æ‡©ú‡©Ä ‡®µ‡®ø‡®∏‡®º‡©á‡®∏‡®º‡®ú‡©∞‡®ú ‡®®‡®æ‡®≤ ‡®∏‡®≤‡®æ‡®π ‡®≤‡®à ‡®ï‡®π‡©ã
          ‡®π‡®Æ‡©á‡®∏‡®º‡®æ‡®Ç ‡®∏‡®ß‡®æ‡®∞‡®£ ‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä ‡®µ‡®ø‡©±‡®ö, ‡®ï‡®ø‡®∏‡®æ‡®® ‡®®‡®æ‡®≤ ‡®ó‡©±‡®≤‡®¨‡®æ‡®§ ‡®ï‡®∞‡®¶‡©á ‡®π‡©ã‡®è ‡®ú‡®ø‡®µ‡©á‡®Ç ‡®ú‡®µ‡®æ‡®¨ ‡®¶‡®ø‡®ì.`
        };

        const systemPrompt = systemPrompts[lang] || systemPrompts['en'];
        console.log('üí¨ System prompt length:', systemPrompt.length);
        
        // Combine system prompt with user query for Gemini
        const fullPrompt = `${systemPrompt}\n\nUser Question: ${query}`;
        
        const result = await model.generateContent(fullPrompt);
        const response = await result.response;
        const answer = response.text();

        console.log('‚úÖ Gemini Response received:', !!answer);
        return res.json({ answer });
        
      } catch (geminiError) {
        console.error('‚ùå Gemini Error:', geminiError.message);
        console.log('üîÑ Falling back to alternative responses...');
        // Fall through to fallback - don't return here
      }
    }

    // Fallback: use HuggingFace or OpenAI REST via axios if SDK key missing
    if (process.env.HUGGINGFACE_API_KEY) {
      console.log('üîÑ Trying HuggingFace fallback...');
      const hfResp = await axios.post(
        'https://api-inference.huggingface.co/models/gpt2',
        { inputs: query },
        { headers: { Authorization: `Bearer ${process.env.HUGGINGFACE_API_KEY}` } }
      );
      const answer = hfResp.data?.generated_text || hfResp.data?.[0]?.generated_text || 'No answer';
      return res.json({ answer });
    }

    // Final fallback: provide a basic response system
    console.log('‚ö†Ô∏è Using intelligent fallback responses');
    const fallbackResponses = {
      'en': {
        'yellow': 'Yellow leaves in crops can be caused by nutrient deficiency (especially nitrogen), overwatering, diseases, or pest damage. Check soil moisture, apply balanced fertilizer, and inspect for pests. Consider soil testing for accurate diagnosis.',
        'rice': 'The best time for rice planting depends on your region. Generally, plant during monsoon season (June-July in most areas). Ensure adequate water supply and prepare fields properly. Use certified seeds for better yield.',
        'pest': 'Natural pest control methods include neem oil spray, companion planting with marigolds, using sticky traps, encouraging beneficial insects, and maintaining good field hygiene. Crop rotation also helps reduce pest buildup.',
        'water': 'For water-efficient crops, consider millets, sorghum, chickpea, mustard, or drought-resistant varieties of your local crops. Use drip irrigation and mulching to conserve water. Rainwater harvesting is also beneficial.',
        'fertilizer': 'Use balanced NPK fertilizers based on soil testing. Organic options include compost, vermicompost, and green manure. Apply fertilizers in split doses for better efficiency and reduced wastage.',
        'crop': 'Choose crops based on your soil type, climate, and water availability. Consider market demand and storage facilities. Diversification helps reduce risk and improve income stability.',
        'disease': 'Common crop diseases can be prevented through proper sanitation, resistant varieties, and appropriate spacing. Use copper-based fungicides for organic treatment. Remove infected plants promptly.',
        'default': 'I\'m KrishiAI, your farming assistant. I can help with crop advice, pest management, fertilizers, and farming techniques. Please ask specific questions about your farming needs - I\'m here to help you succeed!'
      },
      'hi': {
        'yellow': '‡§´‡§∏‡§≤ ‡§Æ‡•á‡§Ç ‡§™‡•Ä‡§≤‡•á ‡§™‡§§‡•ç‡§§‡•á ‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§Æ‡•Ä (‡§ñ‡§æ‡§∏‡§ï‡§∞ ‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§®), ‡§Ö‡§ß‡§ø‡§ï ‡§™‡§æ‡§®‡•Ä, ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§Ø‡§æ ‡§ï‡•Ä‡§ü ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§®‡§Æ‡•Ä ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç, ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§ñ‡§æ‡§¶ ‡§°‡§æ‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§ï‡•Ä‡§ü‡•ã‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∏‡§ü‡•Ä‡§ï ‡§®‡§ø‡§¶‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§æ‡§è‡§Ç‡•§',
        'rice': '‡§ß‡§æ‡§® ‡§ï‡•Ä ‡§¨‡•Å‡§Ü‡§à ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§∏‡§Æ‡§Ø ‡§Ü‡§™‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§®‡§ø‡§∞‡•ç‡§≠‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§Æ‡§æ‡§®‡§∏‡•Ç‡§® ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® (‡§Ö‡§ß‡§ø‡§ï‡§æ‡§Ç‡§∂ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ú‡•Ç‡§®-‡§ú‡•Å‡§≤‡§æ‡§à) ‡§¨‡•Å‡§Ü‡§à ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§™‡§æ‡§®‡•Ä ‡§î‡§∞ ‡§ñ‡•á‡§§ ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§¨‡•á‡§π‡§§‡§∞ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§¨‡•Ä‡§ú ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§',
        'pest': '‡§™‡•ç‡§∞‡§æ‡§ï‡•É‡§§‡§ø‡§ï ‡§ï‡•Ä‡§ü ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§®‡•Ä‡§Æ ‡§§‡•á‡§≤ ‡§ï‡§æ ‡§õ‡§ø‡§°‡§º‡§ï‡§æ‡§µ, ‡§ó‡•á‡§Ç‡§¶‡•á ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§•‡•Ä ‡§ñ‡•á‡§§‡•Ä, ‡§ö‡§ø‡§™‡§ö‡§ø‡§™‡•á ‡§ú‡§æ‡§≤, ‡§≤‡§æ‡§≠‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•Ä‡§ü‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§µ‡§æ ‡§î‡§∞ ‡§ñ‡•á‡§§ ‡§ï‡•Ä ‡§∏‡§æ‡§´-‡§∏‡§´‡§æ‡§à ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡•§ ‡§´‡§∏‡§≤ ‡§ö‡§ï‡•ç‡§∞ ‡§≠‡•Ä ‡§ï‡•Ä‡§ü‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§',
        'water': '‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§ï‡§Æ‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§æ‡§ú‡§∞‡§æ, ‡§ú‡•ç‡§µ‡§æ‡§∞, ‡§ö‡§®‡§æ, ‡§∏‡§∞‡§∏‡•ã‡§Ç ‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ñ‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§∞‡•ã‡§ß‡•Ä ‡§ï‡§ø‡§∏‡•ç‡§Æ‡•á‡§Ç ‡§â‡§ó‡§æ‡§è‡§Ç‡•§ ‡§™‡§æ‡§®‡•Ä ‡§¨‡§ö‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡•ç‡§∞‡§ø‡§™ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§î‡§∞ ‡§Æ‡§≤‡•ç‡§ö‡§ø‡§Ç‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§ú‡§≤ ‡§∏‡§Ç‡§ö‡§Ø‡§® ‡§≠‡•Ä ‡§≤‡§æ‡§≠‡§ï‡§æ‡§∞‡•Ä ‡§π‡•à‡•§',
        'fertilizer': '‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ NPK ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§ú‡•à‡§µ‡§ø‡§ï ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§Ç‡§™‡•ã‡§∏‡•ç‡§ü, ‡§µ‡§∞‡•ç‡§Æ‡•Ä‡§ï‡§Ç‡§™‡•ã‡§∏‡•ç‡§ü ‡§î‡§∞ ‡§π‡§∞‡•Ä ‡§ñ‡§æ‡§¶ ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡§Ç‡•§ ‡§¨‡•á‡§π‡§§‡§∞ ‡§¶‡§ï‡•ç‡§∑‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§ï‡•ã ‡§≠‡§æ‡§ó‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡•á‡§Ç‡•§',
        'crop': '‡§Ö‡§™‡§®‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§î‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß‡§§‡§æ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä ‡§Æ‡§æ‡§Ç‡§ó ‡§î‡§∞ ‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§ì‡§Ç ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§µ‡§ø‡§µ‡§ø‡§ß‡•Ä‡§ï‡§∞‡§£ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§ï‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ü‡§Ø ‡§∏‡•ç‡§•‡§ø‡§∞‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§',
        'disease': '‡§Ü‡§Æ ‡§´‡§∏‡§≤ ‡§∞‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§â‡§ö‡§ø‡§§ ‡§∏‡§´‡§æ‡§à, ‡§™‡•ç‡§∞‡§§‡§ø‡§∞‡•ã‡§ß‡•Ä ‡§ï‡§ø‡§∏‡•ç‡§Æ‡•ã‡§Ç ‡§î‡§∞ ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§¶‡•Ç‡§∞‡•Ä ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§∞‡•ã‡§ï‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§ú‡•à‡§µ‡§ø‡§ï ‡§â‡§™‡§ö‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡§æ‡§Ç‡§¨‡§æ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§µ‡§ï‡§®‡§æ‡§∂‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§ø‡§§ ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§π‡§ü‡§æ‡§è‡§Ç‡•§',
        'default': '‡§Æ‡•à‡§Ç ‡§ï‡•É‡§∑‡§øAI ‡§π‡•Ç‡§Ç, ‡§Ü‡§™‡§ï‡§æ ‡§ï‡•É‡§∑‡§ø ‡§∏‡§π‡§æ‡§Ø‡§ï‡•§ ‡§Æ‡•à‡§Ç ‡§´‡§∏‡§≤ ‡§∏‡§≤‡§æ‡§π, ‡§ï‡•Ä‡§ü ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®, ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§î‡§∞ ‡§ï‡•É‡§∑‡§ø ‡§§‡§ï‡§®‡•Ä‡§ï‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç - ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Ç ‡§π‡•Ç‡§Ç!'
      }
    };

    const responses = fallbackResponses[lang] || fallbackResponses['en'];
    const queryLower = query.toLowerCase();
    
    let answer = responses['default'];
    for (const [key, value] of Object.entries(responses)) {
      if (key !== 'default' && queryLower.includes(key)) {
        answer = value;
        break;
      }
    }

    console.log('üì§ Sending fallback response for query:', query);
    return res.json({ answer });
  } catch (err) {
    console.error('‚ùå Unexpected error in farmAI controller:', err.message);
    // Even if there's an unexpected error, provide a helpful response
    const errorResponse = {
      'en': 'I\'m experiencing technical difficulties right now, but I\'m still here to help! Please try asking your question again, or contact your local agricultural extension office for immediate assistance.',
      'hi': '‡§Æ‡•Å‡§ù‡•á ‡§Ö‡§≠‡•Ä ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Æ‡•à‡§Ç ‡§Ö‡§≠‡•Ä ‡§≠‡•Ä ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Ç ‡§π‡•Ç‡§Ç! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•Ç‡§õ‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç, ‡§Ø‡§æ ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§'
    };
    const message = errorResponse[req.body.lang] || errorResponse['en'];
    return res.json({ answer: message });
  }
};

// For image-based disease detection using Google Gemini Vision
exports.diseaseDetection = async (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No image uploaded' });
  
  try {
    const imagePath = path.resolve(req.file.path);
    const lang = req.body.lang || 'en';
    
    // Try Google Gemini Vision first
    const geminiKey = process.env.GOOGLE_GEMINI_API_KEY;
    if (geminiKey) {
      try {
        const genAI = new GoogleGenerativeAI(geminiKey);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        
        // Read the image file
        const imageData = fs.readFileSync(imagePath);
        const base64Image = imageData.toString('base64');
        
        const imagePart = {
          inlineData: {
            data: base64Image,
            mimeType: req.file.mimetype
          }
        };
        
        // Create appropriate prompt based on language
        const prompts = {
          'en': `You are an expert agricultural AI assistant. Analyze this crop image and provide:
          1. Crop identification (if possible)
          2. Disease/pest/nutrient deficiency detection
          3. Severity assessment (mild/moderate/severe)
          4. Practical treatment recommendations
          5. Prevention measures for farmers
          
          Provide simple, farmer-friendly advice that can be easily understood and implemented. Focus on cost-effective solutions.`,
          
          'hi': `‡§Ü‡§™ ‡§è‡§ï ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§ï‡•É‡§∑‡§ø AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏ ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§õ‡§µ‡§ø ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç:
          1. ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® (‡§Ø‡§¶‡§ø ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•ã)
          2. ‡§∞‡•ã‡§ó/‡§ï‡•Ä‡§ü/‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ ‡§ï‡•Ä ‡§ï‡§Æ‡•Ä ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ó‡§æ‡§®‡§æ
          3. ‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ ‡§ï‡§æ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® (‡§π‡§≤‡•ç‡§ï‡§æ/‡§Æ‡§ß‡•ç‡§Ø‡§Æ/‡§ó‡§Ç‡§≠‡•Ä‡§∞)
          4. ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§â‡§™‡§ö‡§æ‡§∞ ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç
          5. ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§ö‡§æ‡§µ ‡§ï‡•á ‡§â‡§™‡§æ‡§Ø
          
          ‡§∏‡§∞‡§≤, ‡§ï‡§ø‡§∏‡§æ‡§®-‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ ‡§∏‡§≤‡§æ‡§π ‡§¶‡•á‡§Ç ‡§ú‡•ã ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§∏‡§Æ‡§ù‡•Ä ‡§î‡§∞ ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§ ‡§≤‡§æ‡§ó‡§§-‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç‡•§ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§`,
          
          'mr': `‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§è‡§ï ‡§§‡§ú‡•ç‡§û ‡§ï‡•É‡§∑‡•Ä AI ‡§∏‡§π‡§æ‡§Ø‡•ç‡§Ø‡§ï ‡§Ü‡§π‡§æ‡§§. ‡§Ø‡§æ ‡§™‡§ø‡§ï‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§Æ‡•á‡§ö‡•á ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§æ ‡§Ü‡§£‡§ø ‡§¶‡•ç‡§Ø‡§æ:
          1. ‡§™‡§ø‡§ï‡§æ‡§ö‡•Ä ‡§ì‡§≥‡§ñ (‡§∂‡§ï‡•ç‡§Ø ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏)
          2. ‡§∞‡•ã‡§ó/‡§ï‡•Ä‡§ü‡§ï/‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§ï‡§Æ‡§§‡§∞‡§§‡•á‡§ö‡§æ ‡§∂‡•ã‡§ß
          3. ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡•á‡§ö‡•á ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® (‡§∏‡•å‡§Æ‡•ç‡§Ø/‡§Æ‡§ß‡•ç‡§Ø‡§Æ/‡§ó‡§Ç‡§≠‡•Ä‡§∞)
          4. ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§â‡§™‡§ö‡§æ‡§∞ ‡§∂‡§ø‡§´‡§æ‡§∞‡§∏‡•Ä
          5. ‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß‡§ï ‡§â‡§™‡§æ‡§Ø
          
          ‡§∏‡•ã‡§™‡§æ, ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä-‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§¶‡•ç‡§Ø‡§æ ‡§ú‡•ã ‡§∏‡§π‡§ú‡§™‡§£‡•á ‡§∏‡§Æ‡§ú‡§≤‡§æ ‡§Ü‡§£‡§ø ‡§Ö‡§Ç‡§Æ‡§≤‡§æ‡§§ ‡§Ü‡§£‡§≤‡§æ ‡§ú‡§æ‡§ä ‡§∂‡§ï‡•á‡§≤. ‡§ï‡§ø‡§´‡§æ‡§Ø‡§§‡§∂‡•Ä‡§∞ ‡§â‡§™‡§æ‡§Ø‡§æ‡§Ç‡§µ‡§∞ ‡§≤‡§ï‡•ç‡§∑ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡§æ. ‡§Æ‡§∞‡§æ‡§†‡•Ä‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•ç‡§Ø‡§æ‡•§`
        };
        
        const prompt = prompts[lang] || prompts['en'];
        
        const result = await model.generateContent([prompt, imagePart]);
        const response = await result.response;
        const analysisResult = response.text();
        
        // Remove temp file
        fs.unlinkSync(imagePath);
        
        console.log('‚úÖ Gemini Vision analysis completed');
        return res.json({ result: analysisResult });
        
      } catch (geminiError) {
        console.error('‚ùå Gemini Vision Error:', geminiError.message);
        // Fall back to ML service
      }
    }
    
    // Fallback: Forward image to ML service (Python backend)
    console.log('üîÑ Using ML service fallback for image analysis');
    const mlServiceUrl = process.env.ML_SERVICE_URL || 'http://localhost:5001/detect-disease';
    const formData = new FormData();
    formData.append('image', fs.createReadStream(imagePath));
    formData.append('lang', lang);
    
    const response = await axios.post(mlServiceUrl, formData, {
      headers: { ...formData.getHeaders() }
    });
    
    // Remove temp file
    fs.unlinkSync(imagePath);
    res.json({ result: response.data.result });
    
  } catch (err) {
    // Clean up temp file if it exists
    try {
      if (req.file && req.file.path) {
        fs.unlinkSync(path.resolve(req.file.path));
      }
    } catch (cleanupError) {
      console.error('Cleanup error:', cleanupError.message);
    }
    
    console.error('‚ùå Disease detection error:', err.message);
    
    // Provide helpful fallback response
    const errorResponses = {
      'en': 'I\'m having trouble analyzing the image right now. Please ensure the image is clear and shows the affected plant parts. You can also try uploading again or consult with your local agricultural expert.',
      'hi': '‡§Æ‡•Å‡§ù‡•á ‡§Ö‡§≠‡•Ä ‡§õ‡§µ‡§ø ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§õ‡§µ‡§ø ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§π‡•à ‡§î‡§∞ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§™‡•å‡§ß‡•á ‡§ï‡•á ‡§π‡§ø‡§∏‡•ç‡§∏‡•á ‡§¶‡§ø‡§ñ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§∏‡•á ‡§∏‡§≤‡§æ‡§π ‡§≤‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§',
      'mr': '‡§Æ‡§≤‡§æ ‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§Æ‡•á‡§ö‡•á ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ø‡•á‡§§ ‡§Ü‡§π‡•á. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§ï‡§∞‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§Æ‡§æ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§Ü‡§π‡•á ‡§Ü‡§£‡§ø ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§µ‡§®‡§∏‡•ç‡§™‡§§‡•Ä‡§ö‡•á ‡§≠‡§æ‡§ó ‡§¶‡§ø‡§∏‡§§ ‡§Ü‡§π‡•á‡§§. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•Ç‡§® ‡§™‡§æ‡§π‡•Ç ‡§∂‡§ï‡§§‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§ï‡•É‡§∑‡•Ä ‡§§‡§ú‡•ç‡§û‡§æ‡§ö‡§æ ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§ò‡•á‡§ä ‡§∂‡§ï‡§§‡§æ.'
    };
    
    const lang = req.body.lang || 'en';
    const errorMessage = errorResponses[lang] || errorResponses['en'];
    
    res.status(500).json({ 
      error: 'Disease detection failed', 
      result: errorMessage,
      details: err.message 
    });
  }
};

// Translate arbitrary text to target language using Gemini
exports.translateText = async (req, res) => {
  try {
    const { text, targetLang } = req.body || {};
    if (!text || !targetLang) {
      return res.status(400).json({ message: 'text and targetLang are required' });
    }

    const geminiKey = process.env.GOOGLE_GEMINI_API_KEY;
    if (!geminiKey) {
      return res.status(500).json({ message: 'Gemini API key not configured' });
    }

    const langLabel =
      targetLang === 'hi' ? 'Hindi'
      : targetLang === 'mr' ? 'Marathi'
      : targetLang === 'ta' ? 'Tamil'
      : targetLang === 'bn' ? 'Bengali'
      : targetLang === 'te' ? 'Telugu'
      : targetLang === 'gu' ? 'Gujarati'
      : targetLang === 'kn' ? 'Kannada'
      : targetLang === 'or' ? 'Odia'
      : targetLang === 'ml' ? 'Malayalam'
      : targetLang === 'pa' ? 'Punjabi'
      : 'English';

    const genAI = new GoogleGenerativeAI(geminiKey);
    const model = genAI.getGenerativeModel({ model: 'gemini-1.5-flash' });
    const prompt = `Translate the following text to ${langLabel}. Keep agricultural context, be simple and farmer-friendly. Output only the translated text without any additional commentary or quotes.\n\nText:\n${text}`;

    const result = await model.generateContent(prompt);
    const response = await result.response;
    const translated = (response.text && response.text()) || '';

    return res.json({ translated });
  } catch (err) {
    console.error('‚ùå Translation error:', err.message);
    return res.status(500).json({ message: 'Translation failed', details: err.message });
  }
};
